'use strict';

var app = module.exports = {};

/**
 * object req (HttpRequest)
 * object res (HttpResonse)
 * object obj (Data)
 */
app.send = function(req, res, obj) {
	var callback = "";
	
	if (req.getQuery().length > 0) {
		var query = req.getQuery().split("&");
		for (var i=0; i < query.length; i++) {
			if (query[i].indexOf("callback") > -1) {
				var query_item = query[i].split("=");
				var callback = query_item[1];
			}
		}
	
		if (callback == "") {
//			res.send((JSON.stringify({"error":"no callback method provided, must be in jsonp format."})));
//			return true;
		}
	}
	
	if (callback == "") {
		res.header('Content-Type', 'application/json');
		var datastring = JSON.stringify(obj);
		res.end(datastring);
	} else {
		var datastring = callback + "(" + JSON.stringify(obj) + ");";
		res.header('Content-Type', 'application/javascript');
		res.header('Content-Length', datastring.length);
		res.header('Charset', 'utf-8');
		res.end(datastring);	
	}
}
